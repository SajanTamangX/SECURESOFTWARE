{% extends "base.html" %}
{% load tz %}

{% block content %}
<div class="card" style="max-width: 900px; margin: 0 auto;">

    <!-- Email header -->
    <div style="
        background:#ffffff;
        border-radius:8px;
        padding:18px 20px;
        border:1px solid #e1e1e1;
        margin-bottom:18px;
        box-shadow:0 6px 18px rgba(15, 23, 42, 0.06);
    ">
        <div style="
            display:flex;
            align-items:flex-start;
            justify-content:space-between;
            gap:12px;
        ">
            <!-- Subject + meta -->
            <div style="flex:1 1 auto;">
                <div style="font-size:20px; font-weight:600; margin-bottom:8px; color:#111827;">
            {{ email.subject }}
        </div>

                <div style="font-size:13px; color:#4b5563; margin-bottom:2px;">
                    <strong>From:</strong>
                    Indigo Accounts &lt;no-reply@securesoftware.local&gt;
                </div>

                <div style="font-size:13px; color:#4b5563; margin-bottom:2px;">
                    <strong>To:</strong>
                    {{ email.recipient.recipient.email }}
                </div>

                <div style="font-size:13px; color:#6b7280;">
                    <strong>Date:</strong>
                    {{ email.sent_at|localtime|date:"M j, Y, g:i a" }}
                </div>
        </div>

            <!-- Actions (3-dot menu) -->
            <div class="ns-email-header-actions" style="flex:0 0 auto; position:relative;">
                <button
                    type="button"
                    class="ns-email-menu-toggle"
                    aria-haspopup="true"
                    aria-expanded="false"
                    style="
                        border:none;
                        background:transparent;
                        cursor:pointer;
                        padding:4px 6px;
                        border-radius:999px;
                        line-height:1;
                        font-size:20px;
                        color:#6b7280;
                    "
                    title="More actions"
                >
                    â‹®
                </button>

                <div
                    class="ns-email-menu"
                    style="
                        position:absolute;
                        top:120%;
                        right:0;
                        min-width:210px;
                        background:#ffffff;
                        border-radius:8px;
                        border:1px solid #e5e7eb;
                        box-shadow:0 10px 30px rgba(15, 23, 42, 0.15);
                        padding:6px 0;
                        display:none;
                        z-index:20;
                    "
                >
                    <a
                        href="{% url 'campaigns:track_report' email.recipient.tracking_id %}"
                        style="
                            display:block;
                            padding:8px 12px;
                            font-size:13px;
                            color:#b91c1c;
                            text-decoration:none;
                        "
                    >
                        ðŸš© Report this email as suspicious
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Email body -->
    <div style="margin-top:10px;">
        {% if email.body_html %}
            {{ email.body_html|safe }}
        {% else %}
            {{ email.body_text|urlize|linebreaksbr }}
        {% endif %}
    </div>
</div>

<script>
  (function () {
    var container = document.querySelector('.ns-email-header-actions');
    if (!container) return;

    var toggle = container.querySelector('.ns-email-menu-toggle');
    var menu   = container.querySelector('.ns-email-menu');

    if (!toggle || !menu) return;

    // Open / close 3-dot menu
    toggle.addEventListener('click', function (e) {
      e.stopPropagation();
      var isOpen = menu.style.display === 'block';
      menu.style.display = isOpen ? 'none' : 'block';
      toggle.setAttribute('aria-expanded', String(!isOpen));
    });

    // Close menu on outside click
    document.addEventListener('click', function () {
      menu.style.display = 'none';
      toggle.setAttribute('aria-expanded', 'false');
    });
  })();
</script>

<style>
/* Dark mode support for inbox detail */
body.ns-dark div[style*="background:#ffffff"] {
  background: #1e293b !important;
  border-color: rgba(255,255,255,0.1) !important;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3) !important;
}

body.ns-dark div[style*="color:#111827"] {
  color: #f1f5f9 !important;
}

body.ns-dark div[style*="color:#4b5563"] {
  color: #cbd5e1 !important;
}

body.ns-dark div[style*="color:#6b7280"] {
  color: #9ca3af !important;
}

body.ns-dark button[style*="color:#6b7280"] {
  color: #9ca3af !important;
}

body.ns-dark button[style*="color:#6b7280"]:hover {
  color: #cbd5e1 !important;
  background: rgba(255,255,255,0.05) !important;
}

body.ns-dark .ns-email-menu {
  background: #1e293b !important;
  border-color: rgba(255,255,255,0.1) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5) !important;
}

body.ns-dark .ns-email-menu button,
body.ns-dark .ns-email-menu a {
  color: #e2e8f0 !important;
}

body.ns-dark .ns-email-menu button:hover,
body.ns-dark .ns-email-menu a:hover {
  background: rgba(255,255,255,0.05) !important;
}

body.ns-dark .ns-email-menu a[style*="color:#b91c1c"] {
  color: #f87171 !important;
}
</style>

{% endblock %}
