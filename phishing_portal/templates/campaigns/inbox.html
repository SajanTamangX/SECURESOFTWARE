{% extends "base.html" %}

{% block content %}
<div class="card" style="max-width: 1100px; margin: 0 auto;">

  <!-- Header -->
  <div style="
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
  ">
    <div>
      <h1 style="margin:0; font-size:22px;">Inbox</h1>
      <p style="margin:4px 0 0 0; font-size:13px; color:#6b7280;">
        Emails sent to your training account.
      </p>
    </div>
    <span style="
        font-size:12px;
        padding:4px 10px;
        border-radius:999px;
        background:#eff6ff;
        color:#1d4ed8;
    ">
      {{ emails|length }} message{% if emails|length != 1 %}s{% endif %}
    </span>
  </div>

  {% if emails %}
    <div class="ns-table-wrapper">
      <table class="table" style="font-size:13px;">
        <thead>
          <tr>
            <th style="width:{% if user_role == 'VIEWER' %}50%{% else %}40%{% endif %};">Subject</th>
            {% if user_role != 'VIEWER' %}
            <th>Campaign</th>
            <th>To</th>
            {% endif %}
            <th>Sent</th>
            <th>Status</th>
            <th style="text-align:right;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for email in emails %}
            <tr
              style="
                {% if not email.is_read %}background:#f9fafb;{% endif %}
              "
            >
              <td onclick="window.location.href='{% url 'campaigns:inbox_detail' email.pk %}'"
                  style="cursor:pointer;">
                <div style="display:flex; flex-direction:column;">
                  <span style="
                    {% if not email.is_read %}
                      font-weight:600; color:#111827;
                    {% else %}
                      color:#111827;
                    {% endif %}
                  ">
                    {{ email.subject }}
                  </span>
                  <span style="font-size:12px; color:#6b7280; margin-top:2px;">
                    Indigo Accounts &lt;no-reply@securesoftware.local&gt;
                  </span>
                </div>
              </td>
              {% if user_role != 'VIEWER' %}
              <td>
                <span style="font-size:12px; color:#374151;">
                  {{ email.campaign.name }}
                </span>
              </td>
              <td>
                <span style="font-size:12px; color:#4b5563;">
                  {{ email.recipient.recipient.email }}
                </span>
              </td>
              {% endif %}
              <td>
                <span style="font-size:12px; color:#4b5563;">
                  {{ email.sent_at|date:"M j, Y, g:i a" }}
                </span>
              </td>
              <td>
                {% if email.is_read %}
                  <span style="
                    display:inline-block;
                    padding:3px 10px;
                    border-radius:999px;
                    background:#ecfdf3;
                    color:#166534;
                    font-size:11px;
                    font-weight:600;
                  ">
                    Read
                  </span>
                {% else %}
                  <span style="
                    display:inline-block;
                    padding:3px 10px;
                    border-radius:999px;
                    background:#eff6ff;
                    color:#1d4ed8;
                    font-size:11px;
                    font-weight:600;
                  ">
                    Unread
                  </span>
                {% endif %}
              </td>
              <td style="text-align:right;">
                <form method="post"
                      action="{% url 'campaigns:toggle_email_read' email.pk %}"
                      style="display:inline;">
                  {% csrf_token %}
                  <button type="submit"
                          style="
                            font-size:11px;
                            padding:4px 10px;
                            border-radius:999px;
                            border:1px solid #d1d5db;
                            background:#ffffff;
                            cursor:pointer;
                          ">
                    {% if email.is_read %}Mark as unread{% else %}Mark as read{% endif %}
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p style="font-size:14px; color:#6b7280; margin-top:10px;">
      No emails received yet. Your next phishing simulation will appear here.
    </p>
  {% endif %}
</div>

<style>
/* Dark mode support for inbox */
body.ns-dark .table th {
  background: #334155 !important;
  color: #f1f5f9 !important;
}

body.ns-dark tr[style*="background:#f9fafb"] {
  background: #1e293b !important;
}

body.ns-dark span[style*="color:#111827"] {
  color: #f1f5f9 !important;
}

body.ns-dark span[style*="color:#6b7280"],
body.ns-dark span[style*="color:#374151"],
body.ns-dark span[style*="color:#4b5563"] {
  color: #cbd5e1 !important;
}

body.ns-dark button[style*="background:#ffffff"] {
  background: #334155 !important;
  border-color: rgba(255,255,255,0.1) !important;
  color: #e2e8f0 !important;
}

body.ns-dark button[style*="background:#ffffff"]:hover {
  background: #475569 !important;
}
</style>

{% endblock %}
